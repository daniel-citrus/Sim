var e=document.getElementById("exitGame");const t=document.querySelector(".starter .firstPlayer fieldset"),l=document.querySelector(".game"),s=l.querySelector(".board"),r=l.querySelector(".players"),n=document.querySelectorAll(".line");var a=document.getElementById("restartGame"),o=document.getElementById("startGame");const i=document.querySelector(".starter");document.querySelector(".starter .gamemode fieldset").addEventListener("click",e=>{e=e.target.value;"computer"==e?(t.querySelector("label[for='first']").textContent="Player",t.querySelector("label[for='second']").textContent="Computer",r.querySelector(".player1").textContent="Player",r.querySelector(".player2").textContent="Computer",i.querySelector(".difficulty").classList.remove("disabled")):"two_player"==e&&(t.querySelector("label[for='first']").textContent="Blue",t.querySelector("label[for='second']").textContent="Red",r.querySelector(".player1").textContent="Blue",r.querySelector(".player2").textContent="Red",i.querySelector(".difficulty").classList.add("disabled"))}),e.addEventListener("click",()=>{d.exitGame()}),a.addEventListener("click",()=>{console.clear(),d.restartGame()}),o.addEventListener("click",()=>{d.startGame()});let u=e=>{const n=1;let i=()=>{var r=c.getPossibleMoves();let a=r.length;if(!(a<=0)){let e,t;for(;0<a;){var o=s(a),[l,,]=([e,t]=r[o],c.update(e,t,n),c.checkLoser(n));if(c.remove(e,t),!l)break;r.splice(o,1),a=r.length}return[e,t]}};function s(e){return Math.floor(Math.random()*e)}let t;return t="hard"===e?()=>{var a=c.getPossibleMoves(),o=a.length;if(!(o<=0)){if(10<o)return i();let e=Number.NEGATIVE_INFINITY;var l,s;let t,r;console.log("Thinking:");for(s of a)if(c.update(s[0],s[1],n),l=function t(e,r,a,o){let l=c.getPossibleMoves();let s=l.length;let[n]=c.checkLoser(r);let i;if(n)return e?-s:1;{if(e){let e=Number.NEGATIVE_INFINITY;for(var d of l)if(c.update(d[0],d[1],r),i=t(!1,1-r,a,o),c.remove(d[0],d[1]),e=Math.max(e,i),a=Math.max(a,i),o<=a)break;return e}{let e=Number.POSITIVE_INFINITY;for(var u of l)c.update(u[0],u[1],r),i=t(!0,1-r,a,o),c.remove(u[0],u[1]),e=Math.min(e,i),o=Math.min(o,i);return e}}}(!0,n),console.log(`[${s[0]},${s[1]}]: `+l),c.remove(s[0],s[1]),e<l&&(e=l,t=s[0],r=s[1]),15==e)break;return[t,r]}}:"medium"===e?i:()=>{var e=c.getPossibleMoves(),t=e.length;if(!(t<=0))return[e,t]=e[s(t)],[e,t]},Object.assign({},{move:t})};const c=(()=>{let i=new Map,d=[];let u=(t,r,a,o,l,s)=>{if(i.has(l+","+s)&&r==i.get(l+","+s)){if(2==t)return!!i.has(a+","+s)&&r==i.get(a+","+s)&&(d.push([a,s]),!0);for(let e=(l=s)+1;e<7;e++){var n=u(t+1,r,a,o,l,e);if(n)return d.push([l,e]),n}}return!1};return Object.assign({},{checkLoser:e=>{let t=!1;for(var[r,a]of i)if(d=[],a==e){var[a,r]=r.split(",");if(d.push([+a,+r]),t=u(1,e,+a,+r,+a,+r))break}return[t,d]},getPossibleMoves:()=>{var e,t=[];for(e of[[1,2],[1,3],[1,4],[1,5],[1,6],[2,3],[2,4],[2,5],[2,6],[3,4],[3,5],[3,6],[4,5],[4,6],[5,6]])i.has(e[0]+","+e[1])||t.push([e[0],e[1]]);return t},resetBrain:()=>{i.clear()},update:(e,t,r)=>{i.set(e+","+t,r)},remove:(e,t)=>{i.delete(e+","+t)},boardMap:i})})(),d=(()=>{let a,o,l,s,r=(e,t)=>{c.update(e,t,l),m.updateMarker(e,t,l)},n=()=>{m.disableBoard(),setTimeout(()=>{var[e,t]=a.move(),[e,t]=(r(e,t),c.checkLoser(l));e?i(1-l,t):(l=1-l,m.updateCurrentPlayer(l),m.enableBoard())},1e3)},i=(e,t)=>{e=e?"Red":"Blue",console.log(`Winner: ${e}, Triangle: `+t),m.disableBoard(),m.markTriangle(t)};let d=()=>{l=o,m.resetBoard(l),c.resetBrain(),o&&"computer"===s&&n()};return Object.assign({},{exitGame:()=>{m.hideBoard(),m.showStarter()},makeMove:e=>{var t;""===e.getAttribute("marker")&&([e,t]=e.getAttribute("coordinates").split(","),[e,t]=(r(+e,+t),c.checkLoser(l)),e?i(1-l,t):(l=1-l,m.updateCurrentPlayer(l),"computer"===s&&n()))},restartGame:d,startGame:()=>{var e,t,r;for(e of document.getElementsByName("symbol"))e.checked&&(o=+e.value,l=o);for(t of document.getElementsByName("gamemode"))t.checked&&(s=t.value);if("two_player"!==s)for(r of document.getElementsByName("difficulty"))r.checked&&(a=u(r.value));m.hideStarter(),m.showBoard(),d()}})})(),m=(()=>{let a=0;for(let e of n)e.addEventListener("click",()=>{d.makeMove(e)});let r=()=>{s.classList.remove("disabled")};let o=e=>{e?l.classList.add("p2"):l.classList.remove("p2")};return Object.assign({},{disableBoard:()=>{s.classList.add("disabled")},enableBoard:r,hideBoard:()=>{l.style.display="none"},hideStarter:()=>{i.style.display="none"},markTriangle:e=>{for(var t of e){t=s.querySelector(`div[coordinates="${t[0]},${t[1]}"]`);t.classList.add("losingTriangle"),t.style=""}},resetBoard:e=>{for(var t of n)t.setAttribute("marker",""),t.style.zIndex="",t.classList.remove("losingTriangle");r(),o(e),a=0},showBoard:()=>{l.style.display="grid"},showStarter:()=>{i.style.display="block"},updateCurrentPlayer:o,updateMarker:(e,t,r)=>{e=((e,t)=>{for(var r of n)if(r.getAttribute("coordinates")==e+","+t)return r;return null})(e,t);e&&(e.setAttribute("marker",r),a++,e.style.zIndex=a)}})})();