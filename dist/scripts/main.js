const exitButton=document.getElementById("exitGame"),startFirstPlayer=document.querySelector(".starter .firstPlayer fieldset"),game=document.querySelector(".game"),gameBoard=game.querySelector(".board"),gamePlayersDiv=game.querySelector(".players"),lines=document.querySelectorAll(".line"),resetButton=document.getElementById("restartGame"),startButton=document.getElementById("startGame"),starterForm=document.querySelector(".starter"),startGamemode=document.querySelector(".starter .gamemode fieldset");startGamemode.addEventListener("click",e=>{e=e.target.value;"computer"==e?(startFirstPlayer.querySelector("label[for='first']").textContent="Player",startFirstPlayer.querySelector("label[for='second']").textContent="Computer",gamePlayersDiv.querySelector(".player1").textContent="Player",gamePlayersDiv.querySelector(".player2").textContent="Computer",starterForm.querySelector(".difficulty").classList.remove("disabled")):"two_player"==e&&(startFirstPlayer.querySelector("label[for='first']").textContent="Blue",startFirstPlayer.querySelector("label[for='second']").textContent="Red",gamePlayersDiv.querySelector(".player1").textContent="Blue",gamePlayersDiv.querySelector(".player2").textContent="Red",starterForm.querySelector(".difficulty").classList.add("disabled"))}),exitButton.addEventListener("click",()=>{director.exitGame()}),resetButton.addEventListener("click",()=>{director.restartGame()}),startButton.addEventListener("click",()=>{director.startGame()});let bot=e=>{const i=1;let d=()=>{var r=board.getPossibleMoves();let a=r.length;if(!(a<=0)){let e,t;for(;0<a;){var o=s(a),[l,,]=([e,t]=r[o],board.update(e,t,i),board.checkLoser(i));if(board.remove(e,t),!l)break;r.splice(o,1),a=r.length}return[e,t]}};function s(e){return Math.floor(Math.random()*e)}let t;return t="hard"===e?()=>{var a=board.getPossibleMoves(),o=a.length;if(!(o<=0)){if(10<o)return d();let e=Number.NEGATIVE_INFINITY;var l,s;let t,r;for(s of a)board.update(s[0],s[1],i),l=function t(e,r,a,o){let l=board.getPossibleMoves();let s=l.length;let[i]=board.checkLoser(r);let d;if(i)return e?-s:s;{if(e){let e=Number.NEGATIVE_INFINITY;for(var n of l)if(board.update(n[0],n[1],r),d=t(!1,1-r,a,o),board.remove(n[0],n[1]),e=Math.max(e,d),a=Math.max(a,d),o<=a)break;return e}{let e=Number.POSITIVE_INFINITY;for(var u of l)board.update(u[0],u[1],r),d=t(!0,1-r,a,o),board.remove(u[0],u[1]),e=Math.min(e,d),o=Math.min(o,d);return e}}}(!0,i),board.remove(s[0],s[1]),e<l&&(e=l,t=s[0],r=s[1]);return[t,r]}}:"medium"===e?d:()=>{var e=board.getPossibleMoves(),t=e.length;if(!(t<=0))return[e,t]=e[s(t)],[e,t]},Object.assign({},{move:t})};const board=(()=>{let d=new Map,n=[];let u=(t,r,a,o,l,s)=>{if(d.has(l+","+s)&&r==d.get(l+","+s)){if(2==t)return!!d.has(a+","+s)&&r==d.get(a+","+s)&&(n.push([a,s]),!0);for(let e=(l=s)+1;e<7;e++){var i=u(t+1,r,a,o,l,e);if(i)return n.push([l,e]),i}}return!1};return Object.assign({},{checkLoser:e=>{let t=!1;for(var[r,a]of d)if(n=[],a==e){var[a,r]=r.split(",");if(n.push([+a,+r]),t=u(1,e,+a,+r,+a,+r))break}return[t,n]},getPossibleMoves:()=>{var e,t=[];for(e of[[1,2],[1,3],[1,4],[1,5],[1,6],[2,3],[2,4],[2,5],[2,6],[3,4],[3,5],[3,6],[4,5],[4,6],[5,6]])d.has(e[0]+","+e[1])||t.push([e[0],e[1]]);return t},resetBrain:()=>{d.clear()},update:(e,t,r)=>{d.set(e+","+t,r)},remove:(e,t)=>{d.delete(e+","+t)},boardMap:d})})(),director=(()=>{let a,o,l,s,r=(e,t)=>{board.update(e,t,l),displayController.updateMarker(e,t,l)},i=()=>{displayController.botToggleGif(),displayController.disableBoard(),setTimeout(()=>{var[e,t]=a.move(),[e,t]=(r(e,t),board.checkLoser(l));displayController.botToggleGif(),e?d(1-l,t):(l=1-l,displayController.updateCurrentPlayer(l),displayController.enableBoard())},2e3),displayController.botNewGif()},d=(e,t)=>{e="two_player"==s?e?"Red":"Blue":e?"Computer":"Player",displayController.disableBoard(),displayController.markTriangle(t),displayController.displayWinner(e)};let n=()=>{l=o,displayController.resetBoard(l),board.resetBrain(),o&&"computer"===s&&i()};return Object.assign({},{exitGame:()=>{displayController.hideBoard(),displayController.showStarter()},makeMove:e=>{var t;""===e.getAttribute("marker")&&([e,t]=e.getAttribute("coordinates").split(","),[e,t]=(r(+e,+t),board.checkLoser(l)),e?d(1-l,t):(l=1-l,displayController.updateCurrentPlayer(l),"computer"===s&&i()))},restartGame:n,startGame:()=>{var e,t,r;for(e of document.getElementsByName("symbol"))e.checked&&(o=+e.value,l=o);for(t of document.getElementsByName("gamemode"))t.checked&&(s=t.value);if("two_player"!==s)for(r of document.getElementsByName("difficulty"))r.checked&&(a=bot(r.value));displayController.hideStarter(),displayController.showBoard(),document.querySelector(".starter .skip").style.display="block",n()}})})(),displayController=(()=>{let a=0;for(let e of lines)e.addEventListener("click",()=>{director.makeMove(e)});let r=()=>{var e=["batman.gif","ha-think.gif","manifestation.gif","waiting.gif"],t=gamePlayersDiv.querySelector(".gif"),e=e[Math.floor(Math.random()*e.length)];t.style.backgroundImage=`url(/dist/media/gifs/${e})`};let o=()=>{gameBoard.classList.remove("disabled")};let l=e=>{e?game.classList.add("p2"):game.classList.remove("p2")};return Object.assign({},{botNewGif:r,botToggleGif:()=>{var e=gamePlayersDiv.querySelector(".gif");e.style.opacity=1-+e.style.opacity},disableBoard:()=>{gameBoard.classList.add("disabled")},displayWinner:e=>{game.querySelector(".message").textContent=e+" has won!"},enableBoard:o,hideBoard:()=>{game.style.display="none"},hideStarter:()=>{starterForm.style.display="none"},markTriangle:e=>{for(var t of e){t=gameBoard.querySelector(`div[coordinates="${t[0]},${t[1]}"]`);t.classList.add("losingTriangle"),t.style=""}},resetBoard:e=>{game.querySelector(".message").textContent="";for(var t of lines)t.setAttribute("marker",""),t.style.zIndex="",t.classList.remove("losingTriangle");o(),l(e),r(),a=0},showBoard:()=>{game.style.display="grid"},showStarter:()=>{starterForm.style.display="block"},updateCurrentPlayer:l,updateMarker:(e,t,r)=>{e=((e,t)=>{for(var r of lines)if(r.getAttribute("coordinates")==e+","+t)return r;return null})(e,t);e&&(e.setAttribute("marker",r),a++,e.style.zIndex=a)}})})();